{
  "id": 0,
  "distPath": "docs/.vitepress/dist/guides/airnode/rrp-request.html",
  "indexPath": "docs/.vitepress/search-files/guides/airnode/rrp-request.json",
  "docSet": "/guides/",
  "url": "/guides/airnode/rrp-request.html",
  "content": "[ Skip to content ] (#VPContent)  [![image] (/./api3-inactive.png)![image] (/./API3-Active.png)Documentation] (/)  Main Navigation [Home] (/) [Explore] (/explore/) [Guides] (/guides/)  Reference [dAPIs] (/reference/dapis/)  [Airnode] (/reference/airnode/latest/)  [ChainAPI] (/reference/chainapi/)  [OIS] (/reference/ois/latest/)  [QRNG] (/reference/qrng/)  [DAO Members] (/reference/dao-members/)  üîç  [GitHub] (https://github.com/api3dao/api3-docs) [Discord] (https://discord.com/channels/758003776174030948/765618225144266793)  Appearance [GitHub] (https://github.com/api3dao/api3-docs) [Discord] (https://discord.com/channels/758003776174030948/765618225144266793)  Menu [ Return to top ] (#)  üìÇ  Sidebar Navigation  [About the Guides] (/guides/)   dAPIS -----  [‚òÖ Getting Started] (/guides/dapis/) [Calling a dAPI] (/guides/dapis/calling-a-dapi.html) [Starter Project] (/guides/dapis/starter-project.html)   Airnode -------  [‚òÖ Getting Started] (/guides/airnode/) [Quick Start AWS] (/guides/airnode/quick-start-aws/) [Quick Start GCP] (/guides/airnode/deploy-gcp.html) [Quick Start Docker Container] (/guides/airnode/deploy-container.html) [Making an RRP Request] (/guides/airnode/rrp-request.html) [Using RRP Templates] (/guides/airnode/using-rrp-templates.html) [Monorepo Examples] (/guides/airnode/monorepo-examples.html)   ChainAPI --------  [‚òÖ Getting Started] (/guides/chainapi/) [Integrate your API] (/guides/chainapi/integrate.html) [Deploy an API Integration] (/guides/chainapi/deploy.html)   QRNG ----  [‚òÖ Getting Started] (/guides/qrng/) [QRNG Example] (/guides/qrng/qrng-example.html) [Remix Example] (/guides/qrng/remix-example.html) [Youtube QRNG-NFT Example] (/guides/qrng/youtube-nft-example.html)   DAO Members -----------  [‚òÖ Getting Started] (/guides/dao-members/) [Staking Tokens] (/guides/dao-members/staking.html) [Working with Proposals] (/guides/dao-members/proposals.html) [How to Vote] (/guides/dao-members/voting.html) [Videos] (/guides/dao-members/videos.html)  On this page Table of Contents for current page  üìÇ¬†Guides ‚Üí Airnode  Making an RRP Request [#] (#frontmatter-title)  =================================================================================================  TODO: What is Airnode RRP? Start with a short description of the difference between an RRP and a dAPI request. Mention that they are both supported by Airnode. Maybe make this a component so it can be repeated. An Airnode is a first-party oracle that can push off-chain API data to your on-chain smart contract, known as a requester, using the RRP (request-response protocol). A requester is a contract that can trigger an Airnode request. To do so, the requester needs to be sponsored and make the request using a matching sponsor wallet. See [Requesters and Sponsors] (/reference/airnode/latest/concepts/requesters-sponsors.html) on how to sponsor a requester and derive the sponsor wallet. In the diagram below a requester makes a request to the on-chain RRP protocol contract (AirnodeRrpV0.sol) that adds the request to the event logs. The off-chain Airnode then accesses the event logs, gets the API data and performs a callback to the requester. In summary, you only need to do two things. ---Call makeFullRequest() or makeTemplateRequest() on the AirnodeRrpV0.sol contract, which returns a [requestId] (/reference/airnode/latest/concepts/request.html#requestid) . ---Add a myFulfill() function (call it what you like) to your requester (your smart contract) where the off-chain Airnode can send the requested data when ready. The data includes the same requestId as the one returned at the time of making the request. ![image] (/assets/developer-overview.4635ea4e.png) The requester (myContract.sol) makes a request to the RRP protocol contract (AirnodeRrpV0.sol) by calling makeFullRequest() which adds the request to the event logs and returns a requestId to the requester. Airnode retrieves the on-chain request from the event logs. Airnode gathers response data from the API specified in the request. Airnode performs a callback to a named function myFulfill() in myContract.sol via the AirnodeRrpV0.sol function fulfill() with the requested data and the requestId. For a more detailed diagram see the first image in the [Airnode: concepts and definitions] (/reference/airnode/latest/concepts/airnode.html#airnode-processes-rrp-requests) doc. The following section of this document discusses the requester implementation, its deployment and sponsoring.  Step #1: Inherit RrpRequesterV0.sol [#] (#step-1-inherit-rrprequesterv0-sol)  -------------------------------------------------------------------------------------------------------------------------------  A requester inherits from the [RrpRequesterV0.sol] (https://github.com/api3dao/airnode/blob/v0.8/packages/airnode-protocol/contracts/rrp/requesters/RrpRequesterV0.sol) ‚ûö contract. This will expose the AirnodeRrpV0.sol protocol contract to the requester allowing it to make Airnode requests. solidityimport &quot;@api3/airnode-protocol/contracts/rrp/requesters/RrpRequesterV0.sol&quot;; contract MyRequester is V0 { ... constructor (address airnodeRrpAddress) public RrpRequesterV0(airnodeRrpAddress) {} ... }  1 2 3 4 5 6 7 8 9 10 Note the constructor parameter airnodeRrpAddress, which is the public address of the AirnodeRrpV0.sol protocol contract on the blockchain you wish to use. It is used by RrpRequesterV0.sol to point itself to AirnodeRrpV0.sol. See the list of all [Airnode contract addresses] (/reference/airnode/latest/airnode-addresses.html) in the reference section.  Step #2: Implement the request logic [#] (#step-2-implement-the-request-logic)  ---------------------------------------------------------------------------------------------------------------------------------  There are two types of requests provided by the AirnodeRrpV0.sol contract. See the concepts and definitions [Request] (/reference/airnode/latest/concepts/request.html) page for information related to each request type. This example uses a [full request] (/reference/airnode/latest/concepts/request.html#full-request) type (note the airnodeRrp.makeFullRequest function call in the code below) which is called from the requester&#39;s own function callTheAirnode. The function makeFullRequest requires that the requester pass all parameters needed by Airnode to call its underlying API. Once the request has been made to airnodeRrp.makeFullRequest, the AirnodeRrpV0.sol contract returns a requestId confirming the request has been accepted and is in process of being executed. Your requester would most likely wish to track all requestIds. Note the line incomingFulfillments[requestId] = true; in the code below that stores the requestIds in a mapping. This is useful when the Airnode responds to the requester later at the function (airnodeCallback) with the requestId and the data requested. solidityimport &quot;@api3/airnode-protocol/contracts/rrp/requesters/RrpRequesterV0.sol&quot;; contract MyRequester is RrpRequesterV0 { mapping(bytes32 =&gt; bool) public incomingFulfillments; mapping(bytes32 =&gt; int256) public fulfilledData; constructor (address airnodeRrpAddress) public RrpRequesterV0(airnodeRrpAddress) {} function callTheAirnode( address airnode, bytes32 endpointId, address sponsor, address sponsorWallet, bytes calldata parameters // Inbound API parameters which may already be ABI encoded ) external { bytes32 requestId = airnodeRrp.makeFullRequest( // Make the Airnode request airnode, // airnode endpointId, // endpointId sponsor, // sponsor&#39;s address sponsorWallet, // sponsorWallet address(this), // fulfillAddress this.airnodeCallback.selector, // fulfillFunctionId parameters // API parameters ); incomingFulfillments[requestId] = true; } function airnodeCallback( // The AirnodeRrpV0.sol protocol contract will callback here. bytes32 requestId, bytes calldata data { ... } }  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  Request Parameters [#] (#request-parameters)   A full request using the AirnodeRrpV0.sol contract makeFullRequest function requires all parameters needed by the Airnode application to be passed at runtime. This is in contrast to a template request that would use a template for some or all of the required parameters. Learn more about [Using RRP Templates] (./using-rrp-templates.html) guide. Since the callTheAirnode function makes a [full request] (/reference/airnode/latest/concepts/request.html#full-request) , it must gather the following parameters to pass on to airnodeRrp.makeFullRequest. airnode and endpointId: As a pair, these uniquely identify the endpoint desired at a particular Airnode. sponsor: The [sponsor] (/reference/airnode/latest/concepts/requesters-sponsors.html#what-is-a-sponsor) address. sponsorWallet: The [sponsor wallet] (/reference/airnode/latest/concepts/requesters-sponsors.html#how-to-derive-a-sponsor-wallet) address that the sponsor received when deriving the wallet for the Airnode being called. fulfillAddress and fulfillFunctionId: The public address of your requester contract and its function that is called upon the return of the request. parameters: Specify the API parameters and any [reserved parameters] (/reference/airnode/latest/specifications/reserved-parameters.html) , these must be encoded. See [Airnode ABI specifications] (/reference/airnode/latest/specifications/airnode-abi.html) for how these are encoded. In most, cases the parameters are encoded off-chain and passed to the requester which only forwards them. You can use the [@api3/airnode-abi] (/reference/airnode/latest/packages/airnode-abi.html) package to perform the encoding and decoding. Take a look at the JavaScript snippet below. javascript// JavaScript snippet import { encode } from &#39;@api3/airnode-abi&#39;; const parameters = [ { type: &#39;string32&#39;, name: &#39;coin&#39;, value: &#39;ETH&#39; }, { type: &#39;string32&#39;, name: &#39;apiKey&#39;, value: &#39;UHHS7SRGC975E&#39; }, ]; const encodedData = encode(parameters); console.log(encodedData); // &#39;0x...&#39;  1 2 3 4 5 6 7 8 9 10 11 12 However, this is not a hard requirement and you can encode the parameters on-chain as well. Take a look at the Solidity snippet below. solidity// Solidity snippet abi.encode( string32(&quot;1SS&quot;), string32(&quot;period&quot;), &quot;30d&quot;, string32(&quot;symbols&quot;), &quot;btc,eth,matic,link,uni,sushi,aave,chz,theta,rsr,grt,enj,ocean,kacy&quot; )  1 2 3 4 5 6 7 For additional information on request parameters when calling airnodeRrp.makeFullRequest(), see [Request Parameters] (/reference/airnode/latest/concepts/request.html#request-parameters) in the Reference section.  Step #3: Capture the Response [#] (#step-3-capture-the-response)  -------------------------------------------------------------------------------------------------------------------  As soon as the Airnode gets a request, it gathers the data, encodes it and starts an on-chain transaction responding to the request. The Airnode calls the AirnodeRrpV0.sol contract function fulfill(), which in turn calls the requester, in this case, at airnodeCallback. For the purposes of the callback, recall the request supplied the request contract address and the desired callback function which the AirnodeRrpV0.sol protocol contract stored with the requestId. solidityimport &quot;@api3/airnode-protocol/contracts/rrp/requesters/RrpRequesterV0.sol&quot;; contract MyRequester is RrpRequester { mapping(bytes32 =&gt; bool) public incomingFulfillments; mapping(bytes32 =&gt; int256) public fulfilledData; constructor (address airnodeRrpAddress) public RrpRequesterV0(airnodeRrpAddress) {} function callTheAirnode( ... } function airnodeCallback( // The AirnodeRrpV0.sol protocol contract will callback here. bytes32 requestId, bytes calldata data ) external onlyAirnodeRrp { require(incomingFulfillments[requestId], &quot;No such request made&quot;); delete incomingFulfillments[requestId]; int256 decodedData = abi.decode(data, (int256)); fulfilledData[requestId] = decodedData; } }  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  Response Parameters [#] (#response-parameters)   The callback to a requester contains two parameters, as shown in the airnodeCallback function in the code sample above. ---requestId: First acquired when making the request and passed here as a reference to identify the request for which the response is intended. ---data: In case of a successful response, this is the requested data which has been encoded and contains a [timestamp] (/reference/ois/latest/reserved-parameters.html#timestamp-encoded-to-uint256-on-chain) in addition to other response data. Decode it using the function decode() from the abi object.  Step #4: Deploy and Sponsor the Requester [#] (#step-4-deploy-and-sponsor-the-requester)  -------------------------------------------------------------------------------------------------------------------------------------------  Deploy the requester to the desired blockchain and then sponsor the requester. See [Requesters and Sponsors] (/reference/airnode/latest/concepts/requesters-sponsors.html#how-to-sponsor-a-requester) to learn more about sponsoring a requester. [Previous pageQuick Start Docker Container] (/guides/airnode/deploy-container.html)  [Next pageUsing RRP Templates] (/guides/airnode/using-rrp-templates.html)  Released under the MIT License. Copyright ¬© 2019-present API3 "
}
